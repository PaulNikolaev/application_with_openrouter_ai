# Инструкция по установке и сборке

## Системные требования

- Windows 10/11 или Linux
- Python 3.7 или выше
- pip (Python package manager)
- Git (для клонирования репозитория)
- Минимум 2 ГБ свободного места на диске
- Стабильное интернет-соединение

## Получение кода проекта

### Клонирование репозитория

1. Установите Git, если он еще не установлен:
   - Windows: https://git-scm.com/download/win
   - Linux: `sudo apt-get install git` (Ubuntu/Debian) или используйте менеджер пакетов вашего дистрибутива

2. Клонируйте репозиторий:
```
git clone <repository-url>
cd application_with_openrouter_ai
```

### Альтернативный способ

Если у вас есть архив с проектом:
1. Распакуйте архив в желаемую директорию
2. Откройте терминал в директории проекта

## Установка зависимостей

1. Установите Python с официального сайта:
   https://www.python.org/downloads/

2. Убедитесь, что Python и pip установлены корректно:
```cmd
python --version
pip --version
```

3. Создайте виртуальное окружение (рекомендуется):

**Windows:**
```cmd
python -m venv .venv
.venv\Scripts\activate
```

**Linux:**
```bash
python3 -m venv .venv
source .venv/bin/activate
```

4. Установите необходимые пакеты:
```cmd
pip install -r requirements.txt
```

## Сборка приложения

### Windows

1. Перейдите в директорию проекта
2. Запустите сборку:
```cmd
python build.py
```
3. Все файлы приложения будут созданы в директории `AIChat/` в корне проекта
4. Исполняемый файл: `AIChat/AIChat.exe`

### Linux

1. Перейдите в директорию проекта
2. Запустите сборку:
```bash
python3 build.py
```
3. Все файлы приложения будут созданы в директории `AIChat/` в корне проекта
4. Исполняемый файл: `AIChat/aichat`
5. Сделайте файл исполняемым:
```bash
chmod +x AIChat/aichat
```

## Сборка мобильного приложения (Android APK)

Для сборки Android APK файла требуются дополнительные инструменты и настройки.

### Системные требования для мобильной сборки

- Все требования из раздела "Системные требования"
- Android SDK (Android Software Development Kit)
- Java Development Kit (JDK) версии 11 или выше
- Минимум 5 ГБ свободного места на диске (для Android SDK и сборки)
- Стабильное интернет-соединение

### Установка инструментов для Android сборки

#### 1. Установка Android SDK

**Вариант 1: Через Android Studio (рекомендуется для начинающих)**

1. Скачайте и установите Android Studio:
   - Windows/Linux: https://developer.android.com/studio
2. Запустите Android Studio и выполните первоначальную настройку
3. Android SDK будет установлен автоматически

**Вариант 2: Установка командной строки (для опытных пользователей)**

1. Скачайте Android SDK Command Line Tools:
   - https://developer.android.com/studio#command-tools
2. Распакуйте в желаемую директорию (например, `C:\Android\Sdk`)

#### 2. Установка JDK (Java Development Kit)

1. Скачайте JDK версии 11 или выше:
   - Oracle JDK: https://www.oracle.com/java/technologies/downloads/
   - OpenJDK: https://adoptium.net/
2. Установите JDK, запомните путь установки

#### 3. Настройка переменных окружения

**Windows:**

1. Откройте "Система" → "Дополнительные параметры системы" → "Переменные среды"
2. Добавьте системные переменные:
   - `ANDROID_HOME` → путь к Android SDK (например, `C:\Users\YourName\AppData\Local\Android\Sdk`)
   - `JAVA_HOME` → путь к JDK (например, `C:\Program Files\Java\jdk-17`)
3. Добавьте в `PATH`:
   - `%ANDROID_HOME%\platform-tools`
   - `%ANDROID_HOME%\tools`
   - `%JAVA_HOME%\bin`
4. Перезапустите терминал/IDE для применения изменений

**Linux:**

1. Откройте `~/.bashrc` или `~/.zshrc` (в зависимости от вашей оболочки)
2. Добавьте следующие строки:
```bash
export ANDROID_HOME=$HOME/Android/Sdk
export JAVA_HOME=/usr/lib/jvm/java-17-openjdk-amd64  # Путь к вашей установке JDK
export PATH=$PATH:$ANDROID_HOME/platform-tools:$ANDROID_HOME/tools:$JAVA_HOME/bin
```
3. Примените изменения:
```bash
source ~/.bashrc  # или source ~/.zshrc
```

#### 4. Проверка установки

Проверьте, что все инструменты установлены правильно:

```cmd
# Проверка Android SDK
echo %ANDROID_HOME%  # Windows
echo $ANDROID_HOME   # Linux

# Проверка JDK
java -version
javac -version

# Проверка Python (должен быть в активном виртуальном окружении)
python --version
```

### Установка зависимостей для мобильной сборки

После настройки инструментов установите зависимости для мобильной сборки:

```cmd
pip install -r requirements-mobile.txt
```

Это установит следующие пакеты:
- `flet` - основной фреймворк
- `flet-runtime` - среда выполнения для мобильных платформ
- `flet-builder` - инструменты сборки для мобильных приложений
- `python-dotenv` - управление переменными окружения
- `requests` - HTTP-клиент для API запросов

**Примечание:** `psutil` и `pyinstaller` не требуются для мобильной сборки.

### Сборка Android APK

1. Убедитесь, что виртуальное окружение активировано и все зависимости установлены

2. Перейдите в директорию проекта

3. Запустите сборку:
```cmd
python build_mobile.py
```

4. Скрипт автоматически:
   - Проверит наличие Android SDK и JDK
   - Установит необходимые зависимости
   - Выполнит сборку APK с параметрами по умолчанию

5. После успешной сборки APK файл будет находиться по пути:
   ```
   build/android/app/build/outputs/apk/release/app-release.apk
   ```

### Настройка параметров сборки

При необходимости вы можете изменить параметры сборки, отредактировав функцию `main()` в файле `build_mobile.py`:

- `project_name` - имя проекта (по умолчанию: "AIChat")
- `package_name` - Android package name (по умолчанию: "com.example.aichat")
- `version` - версия приложения (по умолчанию: "1.0.0")
- `build_number` - номер сборки (по умолчанию: 1)
- `android_min_sdk` - минимальная версия Android SDK (по умолчанию: 21, Android 5.0)
- `icon_path` - путь к иконке приложения (автоматически используется `assets/icon.png` если существует)

### Иконка приложения

Для использования собственной иконки в APK:

1. Подготовьте иконку в формате PNG, размером 1024x1024 пикселей
2. Сохраните её как `assets/icon.png`
3. Скрипт сборки автоматически использует эту иконку

Если иконка не найдена, будет использована иконка Flet по умолчанию.

### Установка APK на устройство

1. Включите "Отладка по USB" в настройках разработчика на Android-устройстве
2. Подключите устройство к компьютеру через USB
3. Скопируйте файл `app-release.apk` на устройство
4. Откройте файл на устройстве и разрешите установку из неизвестных источников
5. Установите приложение

### Решение проблем при мобильной сборке

Если сборка не удалась:

1. **Проверьте переменные окружения:**
   - Убедитесь, что `ANDROID_HOME` и `JAVA_HOME` установлены правильно
   - Перезапустите терминал/IDE после изменения переменных окружения

2. **Проверьте установку инструментов:**
   - Убедитесь, что Android SDK установлен и путь `ANDROID_HOME` корректен
   - Проверьте установку JDK командой `java -version`

3. **Проверьте зависимости:**
   - Убедитесь, что все зависимости из `requirements-mobile.txt` установлены
   - Попробуйте переустановить: `pip install -r requirements-mobile.txt --force-reinstall`

4. **Проверьте свободное место:**
   - Убедитесь, что на диске достаточно места (минимум 5 ГБ)

5. **Проверьте логи сборки:**
   - Внимательно прочитайте сообщения об ошибках в консоли
   - Скрипт предоставляет детальные инструкции по решению проблем

6. **Очистите артефакты предыдущей сборки:**
   - Удалите директорию `build/` если она существует
   - Запустите сборку заново

## Примечания

- При сборке PyInstaller создает временные папки `build/` и `dist/` в корне проекта
- После успешной сборки временные папки можно удалить
- При возникновении проблем:
  1. Убедитесь что есть доступ в интернет
  2. Проверьте наличие свободного места
  3. Убедитесь что установлен PyInstaller: `pip install pyinstaller`
  4. Попробуйте запустить сборку повторно
  5. Проверьте вывод консоли на наличие ошибок